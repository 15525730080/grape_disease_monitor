{"version":3,"file":"js/2212.f137bd42.js","mappings":"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","sources":["webpack://lin-cms-vue/./src/lin/model/admin.js","webpack://lin-cms-vue/./src/lin/model/user.js","webpack://lin-cms-vue/./src/view/admin/user/user-info.vue","webpack://lin-cms-vue/./src/view/admin/user/user-info.vue?95a6"],"sourcesContent":["/* eslint-disable class-methods-use-this */\r\nimport { post, get, put, _delete } from '@/lin/plugin/axios'\r\n\r\nexport default class Admin {\r\n  constructor(uPage = 0, uCount = 10, gPage = 0, gCount = 5) {\r\n    this.uPage = uPage\r\n    this.uCount = uCount\r\n    this.lPage = gPage\r\n    this.gCount = gCount\r\n  }\r\n\r\n  async increaseUPage() {\r\n    this.uPage += 1\r\n  }\r\n\r\n  async increaseGPage() {\r\n    this.lPage += 1\r\n  }\r\n\r\n  async decreaseUPage() {\r\n    this.uPage -= 1\r\n    if (this.uPage < 0) {\r\n      this.uPage = 0\r\n    }\r\n  }\r\n\r\n  async decreaseGPage() {\r\n    this.lPage -= 1\r\n    if (this.lPage < 0) {\r\n      this.lPage = 0\r\n    }\r\n  }\r\n\r\n  static getAllPermissions() {\r\n    return get('cms/admin/permission')\r\n  }\r\n\r\n  static async getAdminUsers({ groupId, count = this.uCount, page = this.uPage }) {\r\n    let res\r\n    if (groupId) {\r\n      res = await get('cms/admin/users', {\r\n        count,\r\n        page,\r\n        group_id: groupId,\r\n      })\r\n    } else {\r\n      res = await get('cms/admin/users', {\r\n        count,\r\n        page,\r\n      })\r\n    }\r\n    return res\r\n  }\r\n\r\n  async nextUsersPage() {\r\n    await this.increaseUPage()\r\n    return this.getAdminUsers({})\r\n  }\r\n\r\n  async preUsersPage() {\r\n    await this.decreaseUPage()\r\n    return this.getAdminUsers({})\r\n  }\r\n\r\n  async getGroupsWithPermissions({ count = this.uCount, page = this.uPage }) {\r\n    const res = await get('cms/admin/groups', {\r\n      count,\r\n      page,\r\n    })\r\n    return res\r\n  }\r\n\r\n  async nextGroupsPage() {\r\n    await this.increaseGPage()\r\n    return this.getGroupsWithPermissions({})\r\n  }\r\n\r\n  async preGroupsPage() {\r\n    await this.decreaseGPage()\r\n    return this.getGroupsWithPermissions({})\r\n  }\r\n\r\n  static async getAllGroups() {\r\n    const groups = await get('cms/admin/group/all')\r\n    return groups\r\n  }\r\n\r\n  static async getOneGroup(id) {\r\n    const group = await get(`cms/admin/group/${id}`)\r\n    return group\r\n  }\r\n\r\n  // eslint-disable-next-line camelcase\r\n  static async createOneGroup(name, info, permission_ids) {\r\n    const res = await post('cms/admin/group', {\r\n      name,\r\n      info,\r\n      permission_ids,\r\n    })\r\n    return res\r\n  }\r\n\r\n  static async updateOneGroup(name, info, id) {\r\n    const res = await put(`cms/admin/group/${id}`, {\r\n      name,\r\n      info,\r\n    })\r\n    return res\r\n  }\r\n\r\n  static async deleteOneGroup(id) {\r\n    const res = await _delete(`cms/admin/group/${id}`)\r\n    return res\r\n  }\r\n\r\n  static async deleteOneUser(id) {\r\n    const res = await _delete(`cms/admin/user/${id}`)\r\n    return res\r\n  }\r\n\r\n  // eslint-disable-next-line camelcase\r\n  static async updateOneUser(email, group_ids, id) {\r\n    const res = await put(`cms/admin/user/${id}`, {\r\n      email,\r\n      group_ids,\r\n    })\r\n    return res\r\n  }\r\n\r\n  // eslint-disable-next-line camelcase\r\n  static async dispatchPermissions(group_id, permission_ids) {\r\n    const res = await post('cms/admin/permission/dispatch/batch', {\r\n      group_id,\r\n      permission_ids,\r\n    })\r\n    return res\r\n  }\r\n\r\n  // eslint-disable-next-line camelcase\r\n  static async changePassword(new_password, confirm_password, id) {\r\n    const res = await put(`cms/admin/user/${id}/password`, {\r\n      new_password,\r\n      confirm_password,\r\n    })\r\n    return res\r\n  }\r\n\r\n  // eslint-disable-next-line camelcase\r\n  static async removePermissions(group_id, permission_ids) {\r\n    const res = await post('cms/admin/permission/remove', {\r\n      group_id,\r\n      permission_ids,\r\n    })\r\n    return res\r\n  }\r\n}\r\n","import store from '@/store'\r\nimport _axios, { get, put } from '@/lin/plugin/axios'\r\nimport { saveTokens } from '../util/token'\r\n\r\nexport default class User {\r\n  /**\r\n   * 分配用户\r\n   * @param {object} user 注册信息\r\n   */\r\n  static register(user) {\r\n    return _axios({\r\n      method: 'post',\r\n      url: 'cms/user/register',\r\n      data: {\r\n        email: user.email,\r\n        username: user.username,\r\n        password: user.password,\r\n        group_ids: user.groupIds,\r\n        confirm_password: user.confirmPassword,\r\n      },\r\n      handleError: true,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 登陆获取tokens\r\n   * @param { String } username 用户名\r\n   * @param { String } password 密码\r\n   * @param { String } captcha 验证码\r\n   * @param { String } tag 验证码签名\r\n   */\r\n  static async getToken(username, password, captcha, tag) {\r\n    const tokens = await _axios({\r\n      url: 'cms/user/login',\r\n      method: 'POST',\r\n      data: {\r\n        captcha,\r\n        username,\r\n        password,\r\n      },\r\n      headers: {\r\n        tag,\r\n      },\r\n    })\r\n    saveTokens(tokens.access_token, tokens.refresh_token)\r\n    return tokens\r\n  }\r\n\r\n  /**\r\n   * 获取当前用户信息，并返回User实例\r\n   */\r\n  static async getInformation() {\r\n    const info = await get('cms/user/information')\r\n    const storeUser = store.getters.user === null ? {} : store.getters.user\r\n    return Object.assign({ ...storeUser }, info)\r\n  }\r\n\r\n  /**\r\n   * 获取当前用户信息和所拥有的权限\r\n   */\r\n  static async getPermissions() {\r\n    const info = await get('cms/user/permissions')\r\n    const storeUser = store.getters.user === null ? {} : store.getters.user\r\n    return Object.assign({ ...storeUser }, info)\r\n  }\r\n\r\n  /**\r\n   * 用户修改密码\r\n   * @param {string} newPassword 新密码\r\n   * @param {string} confirmPassword 确认新密码\r\n   * @param {string} oldPassword 旧密码\r\n   */\r\n  // eslint-disable-next-line camelcase\r\n  static updatePassword({ old_password, new_password, confirm_password }) {\r\n    return put('cms/user/change_password', {\r\n      new_password,\r\n      confirm_password,\r\n      old_password,\r\n    })\r\n  }\r\n}\r\n","<template>\r\n  <div class=\"container\">\r\n    <el-form\r\n      ref=\"form\"\r\n      status-icon\r\n      :rules=\"rules\"\r\n      :model=\"userInfo\"\r\n      label-width=\"100px\"\r\n      v-loading=\"loading\"\r\n      :label-position=\"labelPosition\"\r\n      @submit.prevent\r\n    >\r\n      <el-form-item label=\"用户名\" prop=\"username\">\r\n        <el-input clearable v-model=\"userInfo.username\" :disabled=\"isEdited\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"邮箱\" prop=\"email\">\r\n        <el-input clearable :disabled=\"isEdited\" v-model=\"userInfo.email\" auto-complete=\"new-password\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item v-if=\"pageType === 'add'\" label=\"密码\" prop=\"password\">\r\n        <el-input clearable type=\"password\" v-model=\"userInfo.password\" auto-complete=\"new-password\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item v-if=\"pageType === 'add'\" label=\"确认密码\" prop=\"confirmPassword\" label-position=\"top\">\r\n        <el-input clearable type=\"password\" autocomplete=\"off\" v-model=\"userInfo.confirmPassword\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item v-if=\"pageType !== 'password'\" label=\"选择分组\">\r\n        <el-checkbox-group v-model=\"userInfo.groupIds\" size=\"small\" style=\"transform: translateY(5px)\">\r\n          <el-checkbox v-for=\"item in allGroups\" :key=\"item.id\" :label=\"item.id\" border style=\"margin-left: 0\">{{\r\n            item.name\r\n          }}</el-checkbox>\r\n        </el-checkbox-group>\r\n      </el-form-item>\r\n      <el-form-item v-show=\"submit\" class=\"submit\">\r\n        <el-button type=\"primary\" @click=\"submitForm\">保 存</el-button>\r\n        <el-button @click=\"resetForm\">重 置</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, reactive, onMounted } from 'vue'\r\nimport { ElMessage } from 'element-plus'\r\nimport AdminModel from '@/lin/model/admin'\r\nimport UserModel from '@/lin/model/user'\r\n\r\nexport default {\r\n  props: {\r\n    submit: {\r\n      // 表单是否显示功能按钮\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    id: {\r\n      // 用户id\r\n      type: Number,\r\n      default: undefined,\r\n    },\r\n    allGroups: {\r\n      // 所有分组\r\n      type: Array,\r\n      default: () => {},\r\n    },\r\n    labelPosition: {\r\n      // 表单label位置\r\n      type: String,\r\n      default: 'right',\r\n    },\r\n    info: {\r\n      // 用户信息\r\n      type: Object,\r\n      default: () => {},\r\n    },\r\n    pageType: {\r\n      type: String,\r\n      default: 'add', // 区分编辑页面/添加页面\r\n    },\r\n  },\r\n  setup(props, ctx) {\r\n    const form = ref(null)\r\n    const loading = ref(false)\r\n    const isEdited = ref(false) // 能否编辑\r\n\r\n    const userInfo = reactive({\r\n      email: '',\r\n      username: '',\r\n      password: '',\r\n      groupIds: [],\r\n      confirmPassword: '',\r\n    })\r\n\r\n    /**\r\n     * 表单规则验证\r\n     */\r\n    const { rules } = getRules(userInfo)\r\n\r\n    /**\r\n     * 新增或更新管理员信息\r\n     */\r\n    const submitForm = () => {\r\n      form.value.validate(async valid => {\r\n        if (valid) {\r\n          let res = {}\r\n          // 1. 新增用户\r\n          if (props.pageType === 'add') {\r\n            try {\r\n              loading.value = true\r\n              res = await UserModel.register(userInfo)\r\n              if (res.code < window.MAX_SUCCESS_CODE) {\r\n                loading.value = false\r\n                ElMessage.success(`${res.message}`)\r\n                resetForm()\r\n              }\r\n            } catch (e) {\r\n              loading.value = false\r\n              ElMessage.error('新增用户失败')\r\n            }\r\n          } else {\r\n            // 2. 更新用户信息\r\n            const originalGroupIds = props.info.groups.map(item => item.id)\r\n            if (userInfo.groupIds.sort().toString() === originalGroupIds.toString()) {\r\n              ctx.emit('handleInfoResult', false)\r\n              return\r\n            }\r\n\r\n            try {\r\n              loading.value = true\r\n              res = await AdminModel.updateOneUser(userInfo.email, userInfo.groupIds, props.id)\r\n            } catch (e) {\r\n              loading.value = false\r\n            }\r\n            if (res.code < window.MAX_SUCCESS_CODE) {\r\n              loading.value = false\r\n              ElMessage.success(`${res.message}`)\r\n              ctx.emit('handleInfoResult', true)\r\n            } else {\r\n              loading.value = false\r\n            }\r\n          }\r\n        } else {\r\n          ElMessage.error('请填写正确的信息')\r\n        }\r\n      })\r\n    }\r\n\r\n    /**\r\n     * reset表单内容\r\n     */\r\n    const resetForm = () => {\r\n      if (props.pageType === 'edit') {\r\n        setInitialUserInfo()\r\n      } else {\r\n        userInfo.groupIds = []\r\n        form.value.resetFields()\r\n      }\r\n    }\r\n\r\n    /**\r\n     * 编辑页面设置初始值\r\n     */\r\n    const setInitialUserInfo = () => {\r\n      userInfo.email = props.info.email\r\n      userInfo.username = props.info.username\r\n      userInfo.groupIds = props.info.groups.map(item => item.id)\r\n    }\r\n\r\n    /**\r\n     * 通过是否接收到数据来判断当前页面是添加数据还是编辑数据\r\n     */\r\n    onMounted(() => {\r\n      if (props.pageType === 'edit') {\r\n        setInitialUserInfo()\r\n        isEdited.value = true\r\n      }\r\n    })\r\n    return {\r\n      form,\r\n      rules,\r\n      loading,\r\n      isEdited,\r\n      userInfo,\r\n      resetForm,\r\n      submitForm,\r\n    }\r\n  },\r\n}\r\n\r\n/**\r\n * 表单验证规则\r\n */\r\nfunction getRules(userInfo) {\r\n  /**\r\n   * 验证回调函数\r\n   */\r\n  const checkUserName = (rule, value, callback) => {\r\n    if (!value) {\r\n      callback(new Error('用户名不能为空'))\r\n    }\r\n    callback()\r\n  }\r\n  /**\r\n   * 验证密码\r\n   */\r\n  const validatePassword = (rule, value, callback) => {\r\n    if (value === '') {\r\n      callback(new Error('请输入密码'))\r\n    } else if (value.length < 6) {\r\n      callback(new Error('密码长度不能少于6位数'))\r\n    } else {\r\n      callback()\r\n    }\r\n  }\r\n  /**\r\n   * 再次验证密码\r\n   */\r\n  const validatePassword2 = (rule, value, callback) => {\r\n    if (value === '') {\r\n      callback(new Error('请再次输入密码'))\r\n    } else if (value !== userInfo.password) {\r\n      callback(new Error('两次输入密码不一致!'))\r\n    } else {\r\n      callback()\r\n    }\r\n  }\r\n  const rules = {\r\n    password: [{ validator: validatePassword, trigger: 'blur', required: true }],\r\n    username: [{ validator: checkUserName, trigger: ['blur', 'change'], required: true }],\r\n    confirmPassword: [{ validator: validatePassword2, trigger: 'blur', required: true }],\r\n    email: [{ type: 'email', message: '请输入正确的邮箱地址或者不填', trigger: ['blur', 'change'] }],\r\n  }\r\n  return { rules }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.container {\r\n  margin-top: 20px;\r\n  margin-left: -5px;\r\n  max-width: 800px;\r\n\r\n  .submit {\r\n    float: left;\r\n  }\r\n}\r\n</style>\r\n","import { render } from \"./user-info.vue?vue&type=template&id=38f2c362&scoped=true\"\nimport script from \"./user-info.vue?vue&type=script&lang=js\"\nexport * from \"./user-info.vue?vue&type=script&lang=js\"\n\nimport \"./user-info.vue?vue&type=style&index=0&id=38f2c362&lang=scss&scoped=true\"\n\nimport exportComponent from \"E:\\\\postgraduatecode\\\\lin-cms-vue\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-38f2c362\"]])\n\nexport default __exports__"],"names":["Admin","uPage","uCount","gPage","gCount","this","lPage","increaseUPage","getAdminUsers","decreaseUPage","count","page","get","res","increaseGPage","getGroupsWithPermissions","decreaseGPage","groupId","group_id","groups","id","group","name","info","permission_ids","post","put","_delete","email","group_ids","new_password","confirm_password","User","user","_axios","method","url","data","username","password","groupIds","confirmPassword","handleError","captcha","tag","headers","tokens","saveTokens","access_token","refresh_token","storeUser","store","Object","assign","old_password","class","ref","rules","model","userInfo","labelPosition","label","prop","clearable","disabled","isEdited","pageType","type","autocomplete","size","style","allGroups","item","key","border","submitForm","resetForm","submit","loading","props","Boolean","default","Number","undefined","Array","String","setup","ctx","form","getRules","value","validate","valid","code","window","MAX_SUCCESS_CODE","message","originalGroupIds","map","sort","toString","emit","setInitialUserInfo","resetFields","checkUserName","rule","callback","Error","validatePassword","length","validatePassword2","validator","trigger","required","__exports__","render"],"sourceRoot":""}
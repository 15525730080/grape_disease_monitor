{"version":3,"file":"js/1966.ce247d4f.js","mappings":"qQAGSA,MAAM,a,uBACT,OAEM,OAFDA,MAAM,UAAQ,EACjB,OAA6B,OAAxBA,MAAM,SAAQ,UADrB,E,OAKKA,MAAM,c,GACJA,MAAM,kB,GACFC,IAAI,WAAWC,MAAM,MAAMC,OAAO,MAAMC,SAAA,GAASC,MAAA,I,WAEV,W,sEAZtD,QAoBM,aAlBJ,OAiBM,MAjBN,EAiBM,CAhBJ,GAKA,OAUM,MAVN,EAUM,EATJ,OAEM,MAFN,EAEM,EADJ,OAAsE,QAAtE,EAAsE,aAExE,QAEY,GAFDC,KAAK,UAAW,QAAO,EAAAC,cAAlC,C,kBAAgD,iBAEhD,GAFgD,I,KAAhD,gBAGA,QAEY,GAFDD,KAAK,UAAW,QAAO,EAAAE,kBAAlC,C,kBACE,iBAAqC,mBAAlC,EAAAC,cAAa,kBAAhB,I,KADF,oB,sFAaR,GACEC,MADa,WAEX,IAAMC,GAAW,QAAI,MACjBC,EAAc,KACdH,GAAgB,SAAI,GACpBI,EAAqB,KAGnBC,EAAS,kDAAI,6HAEMC,UAAUC,aAAaC,aAAa,CAAEC,OAAO,IAFnD,UAETC,EAFS,OAGfP,EAAcO,EAETR,EAASS,MALC,uBAMb,WAAgB,WANH,0BAUfT,EAASS,MAAMC,UAAYF,EAC3BR,EAASS,MAAME,iBAAmB,WAChCX,EAASS,MAAMG,MAChB,EAbc,qDAefC,QAAQC,MAAM,WAAd,MACA,WAAgB,mBAhBD,0DAAJ,qDAqBTlB,EAAW,kDAAI,iHACdI,EAASS,MADK,uBAEjB,WAAgB,WAFC,iCAMbM,EAASC,SAASC,cAAc,UAChCC,EAAUH,EAAOI,WAAW,MAC5BZ,EAAQP,EAASS,MAEvBM,EAAOxB,MAAQgB,EAAMa,WACrBL,EAAOvB,OAASe,EAAMc,YAEtBH,EAAQI,UAAUf,EAAO,EAAG,EAAGQ,EAAOxB,MAAOwB,EAAOvB,QAE9C+B,EAAQR,EAAOS,UAAU,aAfZ,oBAiBI,QAAU,wBAjBd,eAiBbC,EAjBa,iBAkBI,QACnB,iCAAmCA,EAASC,MAnB7B,eAkBbC,EAlBa,iBAsBX,SAAW,+CAAgD,CAC/DJ,MAAOA,EACPK,KAAMC,KAAKC,MAAMC,aAAaC,QAAQ,SAAS,QAAQ,YACvDC,gBAAiBN,EAASD,KAAKA,KAAKQ,MAAMC,UAzB3B,QA2BjB,aAAkB,UA3BD,sDA6BjBtB,QAAQC,MAAM,QAAd,MACA,WAAgB,UA9BC,2DAAJ,qDAmCXjB,EAAmB,WACnBC,EAAcW,OAChB2B,cAAclC,GACdA,EAAqB,KACrBJ,EAAcW,OAAQ,EACtB,UAAe,aAEfX,EAAcW,OAAQ,EACtB,aAAkB,WAClBP,EAAqBmC,aAAY,WAC/BzC,GACD,GAAE,KAEN,EAGK0C,EAAgB,WAChBrC,IACFA,EAAYsC,YAAYC,SAAQ,SAACC,GAAD,OAAWA,EAAMC,MAAjB,IAChCzC,EAAc,MAEZC,IACFkC,cAAclC,GACdA,EAAqB,KAExB,EAUD,OARA,SAAU,WACRC,GACD,KAED,SAAgB,WACdmC,GACD,IAEM,CACLtC,SAAAA,EACAJ,aAAAA,EACAC,iBAAAA,EACAC,cAAAA,EAEH,G,WC/HH,MAAM6C,GAA2B,OAAgB,EAAQ,CAAC,CAAC,SAASC,GAAQ,CAAC,YAAY,qBAEzF,O","sources":["webpack://lin-cms-vue/./src/view/identify/identifyimg.vue","webpack://lin-cms-vue/./src/view/identify/identifyimg.vue?8429"],"sourcesContent":["<template>\r\n  <div>\r\n    <!-- 页面标题 -->\r\n    <div class=\"container\">\r\n      <div class=\"header\">\r\n        <div class=\"title\">拍照模式</div>\r\n      </div>\r\n\r\n      <!-- 拍照模式 -->\r\n      <div class=\"photo-mode\">\r\n        <div class=\"camera-preview\">\r\n          <video ref=\"videoRef\" width=\"640\" height=\"480\" autoplay muted></video>\r\n        </div>\r\n        <el-button type=\"success\" @click=\"capturePhoto\">\r\n          拍照并上传\r\n        </el-button>\r\n        <el-button type=\"success\" @click=\"toggleAutoDetect\">\r\n          {{ autoDetecting ? \"停止检测\" : \"自动检测\" }}\r\n        </el-button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, onMounted, onBeforeUnmount } from \"vue\";\r\nimport { ElMessage } from \"element-plus\";\r\nimport axios from \"axios\";\r\n\r\nexport default {\r\n  setup() {\r\n    const videoRef = ref(null); // 拍照模式的视频元素\r\n    let mediaStream = null; // 存储摄像头流\r\n    let autoDetecting = ref(false); // 自动检测状态\r\n    let autoDetectInterval = null; // 自动检测定时器\r\n\r\n    // 初始化摄像头\r\n    const initCamera = async () => {\r\n      try {\r\n        const stream = await navigator.mediaDevices.getUserMedia({ video: true });\r\n        mediaStream = stream;\r\n\r\n        if (!videoRef.value) {\r\n          ElMessage.error(\"未找到视频元素\");\r\n          return;\r\n        }\r\n\r\n        videoRef.value.srcObject = stream;\r\n        videoRef.value.onloadedmetadata = () => {\r\n          videoRef.value.play();\r\n        };\r\n      } catch (error) {\r\n        console.error(\"无法访问摄像头:\", error);\r\n        ElMessage.error(\"无法访问摄像头，请检查设备权限\");\r\n      }\r\n    };\r\n\r\n    // 拍照并上传\r\n    const capturePhoto = async () => {\r\n      if (!videoRef.value) {\r\n        ElMessage.error(\"摄像头未初始化\");\r\n        return;\r\n      }\r\n\r\n      const canvas = document.createElement(\"canvas\");\r\n      const context = canvas.getContext(\"2d\");\r\n      const video = videoRef.value;\r\n\r\n      canvas.width = video.videoWidth;\r\n      canvas.height = video.videoHeight;\r\n\r\n      context.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n\r\n      const image = canvas.toDataURL(\"image/png\");\r\n      try {\r\n        let tmp_res1 = await axios.get(\"https://ipinfo.io/ip\");\r\n        let tmp_res2 = await axios.get(\r\n          \"https://ipinfo.io/widget/demo/\" + tmp_res1.data\r\n        );\r\n\r\n        await axios.post(\"https://192.168.199.116:20229/upload_base64/\", {\r\n          image: image,\r\n          user: JSON.parse(localStorage.getItem(\"vuex\"))[\"user\"][\"username\"],\r\n          upload_solution: tmp_res2.data.data.abuse.address,\r\n        });\r\n        ElMessage.success(\"照片上传成功\");\r\n      } catch (error) {\r\n        console.error(\"上传失败:\", error);\r\n        ElMessage.error(\"照片上传失败\");\r\n      }\r\n    };\r\n\r\n    // 自动检测功能\r\n    const toggleAutoDetect = () => {\r\n      if (autoDetecting.value) {\r\n        clearInterval(autoDetectInterval);\r\n        autoDetectInterval = null;\r\n        autoDetecting.value = false;\r\n        ElMessage.info(\"自动检测已停止\");\r\n      } else {\r\n        autoDetecting.value = true;\r\n        ElMessage.success(\"自动检测已启动\");\r\n        autoDetectInterval = setInterval(() => {\r\n          capturePhoto();\r\n        }, 30000); // 每 3 秒调用一次\r\n      }\r\n    };\r\n\r\n    // 释放摄像头资源\r\n    const releaseCamera = () => {\r\n      if (mediaStream) {\r\n        mediaStream.getTracks().forEach((track) => track.stop());\r\n        mediaStream = null;\r\n      }\r\n      if (autoDetectInterval) {\r\n        clearInterval(autoDetectInterval);\r\n        autoDetectInterval = null;\r\n      }\r\n    };\r\n\r\n    onMounted(() => {\r\n      initCamera();\r\n    });\r\n\r\n    onBeforeUnmount(() => {\r\n      releaseCamera();\r\n    });\r\n\r\n    return {\r\n      videoRef,\r\n      capturePhoto,\r\n      toggleAutoDetect,\r\n      autoDetecting,\r\n    };\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.container {\r\n  padding: 20px;\r\n\r\n  .header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n\r\n    .title {\r\n      font-size: 18px;\r\n      font-weight: 500;\r\n    }\r\n  }\r\n\r\n  .camera-preview {\r\n    margin-bottom: 20px;\r\n  }\r\n\r\n  video {\r\n    border: 1px solid #ccc;\r\n    border-radius: 4px;\r\n  }\r\n}\r\n</style>","import { render } from \"./identifyimg.vue?vue&type=template&id=e99d2f5a&scoped=true\"\nimport script from \"./identifyimg.vue?vue&type=script&lang=js\"\nexport * from \"./identifyimg.vue?vue&type=script&lang=js\"\n\nimport \"./identifyimg.vue?vue&type=style&index=0&id=e99d2f5a&lang=scss&scoped=true\"\n\nimport exportComponent from \"E:\\\\postgraduatecode\\\\lin-cms-vue\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-e99d2f5a\"]])\n\nexport default __exports__"],"names":["class","ref","width","height","autoplay","muted","type","capturePhoto","toggleAutoDetect","autoDetecting","setup","videoRef","mediaStream","autoDetectInterval","initCamera","navigator","mediaDevices","getUserMedia","video","stream","value","srcObject","onloadedmetadata","play","console","error","canvas","document","createElement","context","getContext","videoWidth","videoHeight","drawImage","image","toDataURL","tmp_res1","data","tmp_res2","user","JSON","parse","localStorage","getItem","upload_solution","abuse","address","clearInterval","setInterval","releaseCamera","getTracks","forEach","track","stop","__exports__","render"],"sourceRoot":""}
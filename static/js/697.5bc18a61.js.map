{"version":3,"file":"js/697.5bc18a61.js","mappings":"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","sources":["webpack://lin-cms-vue/./src/lin/model/admin.js","webpack://lin-cms-vue/./src/view/admin/user/use-user.js"],"sourcesContent":["/* eslint-disable class-methods-use-this */\r\nimport { post, get, put, _delete } from '@/lin/plugin/axios'\r\n\r\nexport default class Admin {\r\n  constructor(uPage = 0, uCount = 10, gPage = 0, gCount = 5) {\r\n    this.uPage = uPage\r\n    this.uCount = uCount\r\n    this.lPage = gPage\r\n    this.gCount = gCount\r\n  }\r\n\r\n  async increaseUPage() {\r\n    this.uPage += 1\r\n  }\r\n\r\n  async increaseGPage() {\r\n    this.lPage += 1\r\n  }\r\n\r\n  async decreaseUPage() {\r\n    this.uPage -= 1\r\n    if (this.uPage < 0) {\r\n      this.uPage = 0\r\n    }\r\n  }\r\n\r\n  async decreaseGPage() {\r\n    this.lPage -= 1\r\n    if (this.lPage < 0) {\r\n      this.lPage = 0\r\n    }\r\n  }\r\n\r\n  static getAllPermissions() {\r\n    return get('cms/admin/permission')\r\n  }\r\n\r\n  static async getAdminUsers({ groupId, count = this.uCount, page = this.uPage }) {\r\n    let res\r\n    if (groupId) {\r\n      res = await get('cms/admin/users', {\r\n        count,\r\n        page,\r\n        group_id: groupId,\r\n      })\r\n    } else {\r\n      res = await get('cms/admin/users', {\r\n        count,\r\n        page,\r\n      })\r\n    }\r\n    return res\r\n  }\r\n\r\n  async nextUsersPage() {\r\n    await this.increaseUPage()\r\n    return this.getAdminUsers({})\r\n  }\r\n\r\n  async preUsersPage() {\r\n    await this.decreaseUPage()\r\n    return this.getAdminUsers({})\r\n  }\r\n\r\n  async getGroupsWithPermissions({ count = this.uCount, page = this.uPage }) {\r\n    const res = await get('cms/admin/groups', {\r\n      count,\r\n      page,\r\n    })\r\n    return res\r\n  }\r\n\r\n  async nextGroupsPage() {\r\n    await this.increaseGPage()\r\n    return this.getGroupsWithPermissions({})\r\n  }\r\n\r\n  async preGroupsPage() {\r\n    await this.decreaseGPage()\r\n    return this.getGroupsWithPermissions({})\r\n  }\r\n\r\n  static async getAllGroups() {\r\n    const groups = await get('cms/admin/group/all')\r\n    return groups\r\n  }\r\n\r\n  static async getOneGroup(id) {\r\n    const group = await get(`cms/admin/group/${id}`)\r\n    return group\r\n  }\r\n\r\n  // eslint-disable-next-line camelcase\r\n  static async createOneGroup(name, info, permission_ids) {\r\n    const res = await post('cms/admin/group', {\r\n      name,\r\n      info,\r\n      permission_ids,\r\n    })\r\n    return res\r\n  }\r\n\r\n  static async updateOneGroup(name, info, id) {\r\n    const res = await put(`cms/admin/group/${id}`, {\r\n      name,\r\n      info,\r\n    })\r\n    return res\r\n  }\r\n\r\n  static async deleteOneGroup(id) {\r\n    const res = await _delete(`cms/admin/group/${id}`)\r\n    return res\r\n  }\r\n\r\n  static async deleteOneUser(id) {\r\n    const res = await _delete(`cms/admin/user/${id}`)\r\n    return res\r\n  }\r\n\r\n  // eslint-disable-next-line camelcase\r\n  static async updateOneUser(email, group_ids, id) {\r\n    const res = await put(`cms/admin/user/${id}`, {\r\n      email,\r\n      group_ids,\r\n    })\r\n    return res\r\n  }\r\n\r\n  // eslint-disable-next-line camelcase\r\n  static async dispatchPermissions(group_id, permission_ids) {\r\n    const res = await post('cms/admin/permission/dispatch/batch', {\r\n      group_id,\r\n      permission_ids,\r\n    })\r\n    return res\r\n  }\r\n\r\n  // eslint-disable-next-line camelcase\r\n  static async changePassword(new_password, confirm_password, id) {\r\n    const res = await put(`cms/admin/user/${id}/password`, {\r\n      new_password,\r\n      confirm_password,\r\n    })\r\n    return res\r\n  }\r\n\r\n  // eslint-disable-next-line camelcase\r\n  static async removePermissions(group_id, permission_ids) {\r\n    const res = await post('cms/admin/permission/remove', {\r\n      group_id,\r\n      permission_ids,\r\n    })\r\n    return res\r\n  }\r\n}\r\n","import { ref, onMounted } from 'vue'\r\nimport AdminModel from '@/lin/model/admin'\r\n\r\nexport const useUserList = () => {\r\n  const allGroups = ref([])\r\n  const pageCount = ref(10) // 每页10条数据\r\n  const tableData = ref([])\r\n  const groupId = ref(null)\r\n  const loading = ref(false)\r\n  const totalNum = ref(0) // 分组内的用户总数\r\n  const currentPage = ref(1) // 默认获取第一页的数据\r\n\r\n  /**\r\n   * 获取管理员列表数据\r\n   */\r\n  const getAdminUsers = async () => {\r\n    let res = {}\r\n    try {\r\n      loading.value = true\r\n      res = await AdminModel.getAdminUsers({\r\n        groupId: groupId.value,\r\n        count: pageCount.value,\r\n        page: currentPage.value - 1,\r\n      })\r\n      loading.value = false\r\n      tableData.value = shuffleList(res.items)\r\n      totalNum.value = res.total\r\n    } catch (e) {\r\n      loading.value = false\r\n      console.error(e)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取所有分组数据\r\n   */\r\n  const getAllGroups = async () => {\r\n    try {\r\n      loading.value = true\r\n      allGroups.value = await AdminModel.getAllGroups()\r\n      loading.value = false\r\n    } catch (e) {\r\n      loading.value = false\r\n      console.error(e)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 多分组用 '，' 分割展示\r\n   */\r\n  const shuffleList = users => {\r\n    const list = []\r\n    users.forEach(element => {\r\n      element.groupNames = element.groups.map(item => item.name).join('，')\r\n      list.push(element)\r\n    })\r\n    return list\r\n  }\r\n\r\n  onMounted(async () => {\r\n    await getAdminUsers()\r\n    getAllGroups()\r\n  })\r\n\r\n  return {\r\n    groupId,\r\n    loading,\r\n    totalNum,\r\n    allGroups,\r\n    pageCount,\r\n    tableData,\r\n    currentPage,\r\n    getAdminUsers,\r\n  }\r\n}\r\n\r\nexport const useFormData = (ctx, dialogFormVisible, getAdminUsers, currentPage, loading, info, password) => {\r\n  const id = ref(null)\r\n  const activeTab = ref('修改信息')\r\n\r\n  /**\r\n   * 监听子组件更新管理员信息是否成功\r\n   * 如果更新了管理员信息，重新请求管理员列表\r\n   */\r\n  const handleInfoResult = flag => {\r\n    dialogFormVisible.value = false\r\n    if (flag === true) {\r\n      getAdminUsers()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据分组查询管理员\r\n   */\r\n  const handleChange = async () => {\r\n    currentPage.value = 1\r\n    loading.value = true\r\n    await getAdminUsers()\r\n    loading.value = false\r\n  }\r\n\r\n  /**\r\n   * 监听是否完成密码更新\r\n   * @param {boolean} result 是否完成密码更新\r\n   */\r\n  const handlePasswordResult = result => {\r\n    if (result === true) {\r\n      dialogFormVisible.value = false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 翻页\r\n   */\r\n  const handleCurrentChange = async val => {\r\n    currentPage.value = val\r\n    await getAdminUsers()\r\n  }\r\n\r\n  /**\r\n   * 提交表单信息，更新管理员信息\r\n   */\r\n  const confirmEdit = async () => {\r\n    if (activeTab.value === '修改信息') {\r\n      await info.value.submitForm()\r\n    } else {\r\n      await password.value.submitForm()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 关闭编辑弹窗\r\n   */\r\n  const handleClose = done => {\r\n    dialogFormVisible.value = false\r\n    password.value.resetForm()\r\n    activeTab.value = '修改信息'\r\n    done()\r\n  }\r\n\r\n  const handleClick = tab => {\r\n    activeTab.value = tab.props.name\r\n  }\r\n\r\n  /**\r\n   * 重置表单\r\n   */\r\n  const resetForm = () => {\r\n    if (activeTab.value === '修改信息') {\r\n      info.value.resetForm()\r\n    } else {\r\n      password.value.resetForm()\r\n    }\r\n  }\r\n\r\n  return {\r\n    id,\r\n    activeTab,\r\n    resetForm,\r\n    confirmEdit,\r\n    handleClose,\r\n    handleClick,\r\n    handleChange,\r\n    handleInfoResult,\r\n    handleCurrentChange,\r\n    handlePasswordResult,\r\n  }\r\n}\r\n"],"names":["Admin","uPage","uCount","gPage","gCount","this","lPage","increaseUPage","getAdminUsers","decreaseUPage","count","page","get","res","increaseGPage","getGroupsWithPermissions","decreaseGPage","groupId","group_id","groups","id","group","name","info","permission_ids","post","put","_delete","email","group_ids","new_password","confirm_password","useUserList","allGroups","ref","pageCount","tableData","loading","totalNum","currentPage","value","AdminModel","shuffleList","items","total","console","error","getAllGroups","users","list","forEach","element","groupNames","map","item","join","push","onMounted","useFormData","ctx","dialogFormVisible","password","activeTab","handleInfoResult","flag","handleChange","handlePasswordResult","result","handleCurrentChange","val","confirmEdit","submitForm","handleClose","done","resetForm","handleClick","tab","props"],"sourceRoot":""}
{"version":3,"file":"js/7664.4c81c2e3.js","mappings":"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","sources":["webpack://lin-cms-vue/./src/component/layout/user.vue","webpack://lin-cms-vue/./src/component/layout/user.vue?ee1d"],"sourcesContent":["<template>\r\n  <div class=\"user\">\r\n    <el-dropdown>\r\n      <span class=\"el-dropdown-link\">\r\n        <div class=\"nav-avatar\"><img :src=\"user.avatar || defaultAvatar\" alt=\"头像\" /></div>\r\n      </span>\r\n      <template v-slot:dropdown>\r\n        <el-dropdown-menu class=\"user-box\">\r\n          <div class=\"user-info\">\r\n            <div class=\"avatar\" title=\"点击修改头像\">\r\n              <img :src=\"user.avatar || defaultAvatar\" alt=\"头像\" />\r\n              <label class=\"mask\">\r\n                <i class=\"iconfont icon-icon-test\" style=\"font-size: 20px;\"></i>\r\n                <input ref=\"avatarInput\" type=\"file\" accept=\"image/*\" @change=\"fileChange\" />\r\n              </label>\r\n            </div>\r\n            <div class=\"text\">\r\n              <div class=\"username\" @click=\"changeNickname\" v-if=\"!nicknameChanged\">{{ nickname }}</div>\r\n              <el-input\r\n                placeholder=\"请输入内容\"\r\n                size=\"small\"\r\n                v-else\r\n                v-model=\"nickname\"\r\n                ref=\"input\"\r\n                @blur=\"blur\"\r\n              ></el-input>\r\n              <div class=\"desc\" v-if=\"!nicknameChanged\">{{ groupName }}</div>\r\n            </div>\r\n            <img src=\"../../assets/image/user/corner.png\" class=\"corner\" />\r\n          </div>\r\n          <ul class=\"dropdown-box\">\r\n            <li class=\"password\" @click=\"goToCenter\">\r\n              <i class=\"iconfont icon-weibaoxitongshangchuanlogo-\"></i> <span>个人中心</span>\r\n            </li>\r\n            <li class=\"account\" @click=\"outLogin\"><i class=\"iconfont icon-tuichu\"></i> <span>退出账户</span></li>\r\n          </ul>\r\n        </el-dropdown-menu>\r\n      </template>\r\n    </el-dropdown>\r\n    <!-- 修改头像 -->\r\n    <avatar :originalImage=\"cropImg\" :cropVisible=\"cropVisible\" @switchCropVisible=\"switchCropVisible\"></avatar>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport User from 'lin/model/user'\r\nimport axios from 'lin/plugin/axios'\r\nimport { mapActions, mapGetters } from 'vuex'\r\nimport defaultAvatar from '@/assets/image/user/user.png'\r\nimport Avatar from './avatar.vue'\r\n\r\nexport default {\r\n  name: 'User',\r\n  components: { Avatar },\r\n  data() {\r\n    return {\r\n      cropImg: '',\r\n      defaultAvatar,\r\n      username: null,\r\n      nickname: null,\r\n      groupName: null,\r\n      cropVisible: false,\r\n      nicknameChanged: false,\r\n      dialogFormVisible: false,\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapGetters(['user']),\r\n  },\r\n  watch: {\r\n    cropVisible(val) {\r\n      if (!val) {\r\n        this.cropImg = ''\r\n      }\r\n    },\r\n  },\r\n  created() {\r\n    const { user } = this.$store.state\r\n    this.nickname = user?.nickname ? user.nickname : '佚名'\r\n    this.username = user?.username ? user.username : '未登录'\r\n  },\r\n  methods: {\r\n    ...mapActions(['loginOut', 'setUserAndState']),\r\n    fileChange(event) {\r\n      if (event.target.files.length !== 1) {\r\n        return\r\n      }\r\n\r\n      const imgFile = event.target.files[0]\r\n      // 验证文件大小是否符合要求, 不大于 5M\r\n      if (imgFile.size > 1024 * 1024 * 5) {\r\n        this.$message.error('文件过大超过5M')\r\n        // 清空输入框\r\n        this.clearFileInput(this.$refs.avatarInput)\r\n        return\r\n      }\r\n\r\n      // 验证图像是否符合要求\r\n      const imgSrc = window.URL.createObjectURL(imgFile)\r\n      const image = new Image()\r\n      image.src = imgSrc\r\n      image.onload = () => {\r\n        const w = image.width\r\n        const h = image.height\r\n        if (w < 50) {\r\n          this.$message.error('图像宽度过小, 请选择大于50px的图像')\r\n          // 清空输入框\r\n          this.clearFileInput(this.$refs.avatarInput)\r\n          return\r\n        }\r\n        if (h < 50) {\r\n          this.$message.error('图像高度过小, 请选择大于50px的图像')\r\n          // 清空输入框\r\n          this.clearFileInput(this.$refs.avatarInput)\r\n          return\r\n        }\r\n        // 验证通过, 打开裁剪框\r\n        this.cropImg = imgSrc\r\n        this.cropVisible = true\r\n      }\r\n      image.onerror = () => {\r\n        this.$message.error('获取本地图片出现错误, 请重试')\r\n        // 清空输入框\r\n        this.clearFileInput(this.$refs.avatarInput)\r\n      }\r\n    },\r\n    switchCropVisible(flag) {\r\n      this.cropVisible = flag\r\n    },\r\n    changeNickname() {\r\n      this.nicknameChanged = true\r\n      setTimeout(() => {\r\n        this.$refs.input.focus()\r\n      }, 200)\r\n    },\r\n    async blur() {\r\n      if (this.nickname) {\r\n        const { user } = this.$store.state\r\n        if (this.nickname !== user.nickname && this.nickname !== '佚名') {\r\n          axios({\r\n            method: 'put',\r\n            url: '/cms/user',\r\n            data: {\r\n              nickname: this.nickname,\r\n            },\r\n            showBackend: true,\r\n          })\r\n            .then(res => {\r\n              if (res.code < window.MAX_SUCCESS_CODE) {\r\n                this.$message({\r\n                  type: 'success',\r\n                  message: '更新昵称成功',\r\n                })\r\n                // 触发重新获取用户信息\r\n                return User.getInformation()\r\n              }\r\n            })\r\n            .then(res => {\r\n              this.setUserAndState(res)\r\n              this.nickname = res.nickname\r\n            })\r\n        }\r\n      }\r\n      this.nicknameChanged = false\r\n    },\r\n    goToCenter() {\r\n      this.$router.push('/center')\r\n    },\r\n    outLogin() {\r\n      this.loginOut()\r\n      window.location.reload()\r\n    },\r\n    clearFileInput(ele) {\r\n      ele.value = ''\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.user {\r\n  height: 40px;\r\n\r\n  .el-dropdown-link {\r\n    cursor: pointer;\r\n\r\n    .nav-avatar {\r\n      width: 40px;\r\n      height: 40px;\r\n      border-radius: 50%;\r\n      overflow: hidden;\r\n      margin-right: 10px;\r\n    }\r\n  }\r\n}\r\n\r\n.user-box {\r\n  width: 326px;\r\n  background-color: none;\r\n  background: transparent;\r\n  margin-bottom: 0;\r\n  padding-bottom: 0;\r\n  border: none;\r\n\r\n  .user-info {\r\n    background-image: url('../../assets/image/user/user-bg.png');\r\n    background-size: 100% 100%;\r\n    transform: translateY(-10px);\r\n    border-top-left-radius: 4px;\r\n    border-top-right-radius: 4px;\r\n    display: flex;\r\n    flex-direction: row;\r\n    padding: 35px 20px 25px 30px;\r\n    z-index: 100;\r\n    position: relative;\r\n\r\n    .corner {\r\n      position: absolute;\r\n      right: 18px;\r\n      top: -9px;\r\n      width: 27px;\r\n      height: 10px;\r\n    }\r\n\r\n    .avatar {\r\n      width: 80px;\r\n      height: 80px;\r\n      border-radius: 50%;\r\n      cursor: pointer;\r\n      overflow: hidden;\r\n      position: relative;\r\n\r\n      .mask {\r\n        opacity: 0;\r\n        transition: all 0.2s;\r\n        position: absolute;\r\n        top: 0;\r\n        left: 0;\r\n        width: 100%;\r\n        height: 100%;\r\n        background: rgba(0, 0, 0, 0.3);\r\n        display: flex;\r\n        justify-content: center;\r\n        align-items: center;\r\n        cursor: pointer;\r\n        color: white;\r\n\r\n        input {\r\n          display: none;\r\n        }\r\n      }\r\n\r\n      &:hover {\r\n        .mask {\r\n          opacity: 1;\r\n        }\r\n      }\r\n    }\r\n\r\n    .text {\r\n      margin-left: 20px;\r\n      color: #fff;\r\n      display: flex;\r\n      flex-direction: column;\r\n      justify-content: center;\r\n\r\n      .username {\r\n        margin-bottom: 10px;\r\n        font-size: 16px;\r\n        height: 32px;\r\n        line-height: 32px;\r\n        cursor: pointer;\r\n      }\r\n\r\n      .desc {\r\n        font-size: 14px;\r\n        color: rgba(222, 226, 230, 1);\r\n      }\r\n    }\r\n\r\n    .info {\r\n      position: absolute;\r\n      bottom: 10px;\r\n      right: 10px;\r\n      display: flex;\r\n      color: #fff;\r\n      font-size: 14px;\r\n      height: 20px;\r\n      line-height: 20px;\r\n\r\n      .mid {\r\n        padding: 0 5px;\r\n      }\r\n    }\r\n  }\r\n\r\n  .dropdown-box {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-around;\r\n    padding-left: 35px;\r\n    height: 122px;\r\n    color: #596c8e;\r\n    font-size: 14px;\r\n    background: white;\r\n    margin-top: -10px;\r\n\r\n    li {\r\n      cursor: pointer;\r\n\r\n      &:nth-child(1) {\r\n        margin-top: 20px;\r\n      }\r\n\r\n      &:nth-child(2) {\r\n        margin-bottom: 20px;\r\n      }\r\n\r\n      i {\r\n        margin-right: 10px;\r\n      }\r\n\r\n      &:hover {\r\n        color: $theme !important;\r\n\r\n        i {\r\n          color: $theme !important;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n.popper__arrow {\r\n  display: none !important;\r\n}\r\n\r\n.avatar-croppa-container {\r\n  display: inline-block;\r\n  border-color: #3862bc;\r\n  border-style: dashed;\r\n  font-size: 0;\r\n  border-width: 2px;\r\n}\r\n</style>\r\n","import { render } from \"./user.vue?vue&type=template&id=6e6a5c96&scoped=true\"\nimport script from \"./user.vue?vue&type=script&lang=js\"\nexport * from \"./user.vue?vue&type=script&lang=js\"\n\nimport \"./user.vue?vue&type=style&index=0&id=6e6a5c96&lang=scss&scoped=true\"\n\nimport exportComponent from \"E:\\\\postgraduatecode\\\\lin-cms-vue\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-6e6a5c96\"]])\n\nexport default __exports__"],"names":["class","title","style","src","dropdown","user","avatar","defaultAvatar","alt","ref","type","accept","fileChange","nicknameChanged","placeholder","size","nickname","blur","changeNickname","groupName","goToCenter","outLogin","originalImage","cropImg","cropVisible","switchCropVisible","name","components","Avatar","data","username","dialogFormVisible","computed","watch","val","this","created","$store","state","methods","event","target","files","length","imgFile","$message","error","clearFileInput","$refs","avatarInput","imgSrc","window","URL","createObjectURL","image","Image","onload","w","width","h","height","onerror","flag","setTimeout","input","focus","axios","method","url","showBackend","then","res","code","MAX_SUCCESS_CODE","message","setUserAndState","$router","push","loginOut","location","reload","ele","value","__exports__","render"],"sourceRoot":""}
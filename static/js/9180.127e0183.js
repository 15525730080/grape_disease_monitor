"use strict";(self["webpackChunklin_cms_vue"]=self["webpackChunklin_cms_vue"]||[]).push([[9180,2194],{42194:function(e,t,r){r.r(t),r.d(t,{default:function(){return l}});var n=r(95082),a=r(48534),u=r(13087),s=r(62833),c=(r(35666),r(24239)),o=r(12109),i=r(8593),l=function(){function e(){(0,u.Z)(this,e)}return(0,s.Z)(e,null,[{key:"register",value:function(e){return(0,o["default"])({method:"post",url:"cms/user/register",data:{email:e.email,username:e.username,password:e.password,group_ids:e.groupIds,confirm_password:e.confirmPassword},handleError:!0})}},{key:"getToken",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(t,r,n,a){var u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,o["default"])({url:"cms/user/login",method:"POST",data:{captcha:n,username:t,password:r},headers:{tag:a}});case 2:return u=e.sent,(0,i.saveTokens)(u.access_token,u.refresh_token),e.abrupt("return",u);case 5:case"end":return e.stop()}}),e)})));function t(t,r,n,a){return e.apply(this,arguments)}return t}()},{key:"getInformation",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,o.get)("cms/user/information");case 2:return t=e.sent,r=null===c["default"].getters.user?{}:c["default"].getters.user,e.abrupt("return",Object.assign((0,n.Z)({},r),t));case 5:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getPermissions",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,o.get)("cms/user/permissions");case 2:return t=e.sent,r=null===c["default"].getters.user?{}:c["default"].getters.user,e.abrupt("return",Object.assign((0,n.Z)({},r),t));case 5:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"updatePassword",value:function(e){var t=e.old_password,r=e.new_password,n=e.confirm_password;return(0,o.put)("cms/user/change_password",{new_password:r,confirm_password:n,old_password:t})}}]),e}()},89180:function(e,t,r){r.r(t),r.d(t,{default:function(){return P}});var n=r(66252),a=r(58061),u={class:"login"},s={class:"form-box","element-loading-background":"rgba(0, 0, 0, 0)"},c=(0,n._)("div",{class:"title"},[(0,n._)("h1",null,"葡萄果实病害识别系统")],-1),o={class:"form-item nickname"},i=(0,n._)("span",{class:"icon account-icon"},null,-1),l={class:"form-item password"},p=(0,n._)("span",{class:"icon secret-icon"},null,-1),f={key:0,class:"form-item password"},d=["src"],m=(0,n._)("button",{class:"submit-btn",type:"submit"},"登录",-1);function g(e,t,r,g,h,v){var w=(0,n.Q2)("loading");return(0,n.wg)(),(0,n.iD)("div",u,[(0,n.wy)((0,n._)("div",s,[c,(0,n._)("form",{class:"login-form",autocomplete:"off",onSubmit:t[4]||(t[4]=(0,a.iM)((function(e){return g.throttleLogin()}),["prevent"]))},[(0,n._)("div",o,[i,(0,n.wy)((0,n._)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=function(e){return g.account.username=e}),autocomplete:"off",placeholder:"请填写用户名"},null,512),[[a.nr,g.account.username]])]),(0,n._)("div",l,[p,(0,n.wy)((0,n._)("input",{type:"password","onUpdate:modelValue":t[1]||(t[1]=function(e){return g.account.password=e}),autocomplete:"off",placeholder:"请填写用户登录密码"},null,512),[[a.nr,g.account.password]])]),g.captchaImage?((0,n.wg)(),(0,n.iD)("div",f,[(0,n._)("img",{class:"captcha",src:g.captchaImage,onClick:t[2]||(t[2]=(0,a.iM)((function(e){return g.getCaptcha()}),["stop"]))},null,8,d),(0,n.wy)((0,n._)("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=function(e){return g.account.captcha=e}),autocomplete:"off",placeholder:"请填写验证码"},null,512),[[a.nr,g.account.captcha]])])):(0,n.kq)("",!0),m],32)],512),[[w,g.loading]])])}var h=r(48534),v=(r(35666),r(62931)),w=r(68410),_=r(42119),k=r(81348),y=r(12109),b=r(42194),x=r(73016),R=r(61073),Z={setup:function(){var e="",t=2e3,r=(0,v.iH)(!1),a=(0,v.iH)(""),u=(0,w.oR)(),s=(0,_.tv)(),c=(0,v.iH)(null),o=(0,v.qj)({username:"",password:"",captcha:""}),i=function(){var t=(0,h.Z)(regeneratorRuntime.mark((function t(){var n,a,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=o.username,a=o.password,u=o.captcha,t.prev=1,r.value=!0,t.next=5,b["default"].getToken(n,a,u,e);case 5:return t.next=7,p();case 7:r.value=!1,s.push(R["default"].defaultRoute),(0,k.z8)({message:"登录成功",type:"success"}),t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](1),l(),r.value=!1;case 16:case"end":return t.stop()}}),t,null,[[1,12]])})));return function(){return t.apply(this,arguments)}}(),l=function(){var t=(0,h.Z)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:(0,y["default"])({method:"POST",url:"cms/user/captcha"}).then((function(t){e=t.tag,a.value=t.image}));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),p=function(){var e=(0,h.Z)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b["default"].getPermissions();case 3:t=e.sent,u.dispatch("setUserAndState",t),u.commit("SET_USER_PERMISSIONS",t.permissions),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),console.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();return(0,n.bv)((function(){l(),c.value=x["default"].throttle(i,t)})),{account:o,loading:r,getCaptcha:l,captchaImage:a,throttleLogin:c}}},S=r(83744);const I=(0,S.Z)(Z,[["render",g]]);var P=I}}]);
//# sourceMappingURL=9180.127e0183.js.map
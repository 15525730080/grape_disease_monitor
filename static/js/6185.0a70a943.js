"use strict";(self["webpackChunklin_cms_vue"]=self["webpackChunklin_cms_vue"]||[]).push([[6185],{26185:function(e,t,n){n.r(t),n.d(t,{default:function(){return b}});var r=n(66252),a=n(56612),u=function(e){return(0,r.dD)("data-v-fdcd0af2"),e=e(),(0,r.Cn)(),e},c={class:"container"},o=u((function(){return(0,r._)("div",{class:"header"},[(0,r._)("div",{class:"title"},"拍照模式")],-1)})),i={class:"photo-mode"},s={class:"camera-preview"},l={ref:"videoRef",width:"640",height:"480",autoplay:"",muted:""},d=(0,r.Uk)(" 拍照并上传 ");function v(e,t,n,u,v,f){var p=(0,r.up)("el-button");return(0,r.wg)(),(0,r.iD)("div",null,[(0,r._)("div",c,[o,(0,r._)("div",i,[(0,r._)("div",s,[(0,r._)("video",l,null,512)]),(0,r.Wm)(p,{type:"success",onClick:u.capturePhoto},{default:(0,r.w5)((function(){return[d]})),_:1},8,["onClick"]),(0,r.Wm)(p,{type:"success",onClick:u.toggleAutoDetect},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(u.autoDetecting?"停止检测":"自动检测"),1)]})),_:1},8,["onClick"])])])])}var f=n(48534),p=(n(41539),n(54747),n(35666),n(62931)),h=n(81348),g=n(9669),m=n.n(g),w={setup:function(){var e=(0,p.iH)(null),t=null,n=(0,p.iH)(!1),a=null,u=function(){var n=(0,f.Z)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});case 3:if(r=n.sent,t=r,e.value){n.next=8;break}return h.z8.error("未找到视频元素"),n.abrupt("return");case 8:e.value.srcObject=r,e.value.onloadedmetadata=function(){e.value.play()},n.next=16;break;case 12:n.prev=12,n.t0=n["catch"](0),console.error("无法访问摄像头:",n.t0),h.z8.error("无法访问摄像头，请检查设备权限");case 16:case"end":return n.stop()}}),n,null,[[0,12]])})));return function(){return n.apply(this,arguments)}}(),c=function(){var t=(0,f.Z)(regeneratorRuntime.mark((function t(){var n,r,a,u,c,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.value){t.next=3;break}return h.z8.error("摄像头未初始化"),t.abrupt("return");case 3:return n=document.createElement("canvas"),r=n.getContext("2d"),a=e.value,n.width=a.videoWidth,n.height=a.videoHeight,r.drawImage(a,0,0,n.width,n.height),u=n.toDataURL("image/png"),t.prev=10,t.next=13,m().get("https://ipinfo.io/ip");case 13:return c=t.sent,t.next=16,m().get("https://ipinfo.io/widget/demo/"+c.data);case 16:return o=t.sent,t.next=19,m().post("https://192.168.199.116:20229/upload_base64/",{image:u,user:JSON.parse(localStorage.getItem("vuex"))["user"]["username"],upload_solution:o.data.data.abuse.address});case 19:h.z8.success("照片上传成功"),t.next=26;break;case 22:t.prev=22,t.t0=t["catch"](10),console.error("上传失败:",t.t0),h.z8.error("照片上传失败");case 26:case"end":return t.stop()}}),t,null,[[10,22]])})));return function(){return t.apply(this,arguments)}}(),o=function(){n.value?(clearInterval(a),a=null,n.value=!1,h.z8.info("自动检测已停止")):(n.value=!0,h.z8.success("自动检测已启动"),a=setInterval((function(){c()}),3e4))},i=function(){t&&(t.getTracks().forEach((function(e){return e.stop()})),t=null),a&&(clearInterval(a),a=null)};return(0,r.bv)((function(){u()})),(0,r.Jd)((function(){i()})),{videoRef:e,capturePhoto:c,toggleAutoDetect:o,autoDetecting:n}}},k=n(83744);const _=(0,k.Z)(w,[["render",v],["__scopeId","data-v-fdcd0af2"]]);var b=_}}]);
//# sourceMappingURL=6185.0a70a943.js.map
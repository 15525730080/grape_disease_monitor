{"version":3,"file":"js/6493.f1c302e9.js","mappings":"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","sources":["webpack://lin-cms-vue/./src/view/admin/user/use-user.js","webpack://lin-cms-vue/./src/view/admin/user/user-list.vue","webpack://lin-cms-vue/./src/view/admin/user/user-list.vue?5189","webpack://lin-cms-vue/./src/view/admin/user/user-password.vue","webpack://lin-cms-vue/./src/view/admin/user/user-password.vue?8b77"],"sourcesContent":["import { ref, onMounted } from 'vue'\r\nimport AdminModel from '@/lin/model/admin'\r\n\r\nexport const useUserList = () => {\r\n  const allGroups = ref([])\r\n  const pageCount = ref(10) // 每页10条数据\r\n  const tableData = ref([])\r\n  const groupId = ref(null)\r\n  const loading = ref(false)\r\n  const totalNum = ref(0) // 分组内的用户总数\r\n  const currentPage = ref(1) // 默认获取第一页的数据\r\n\r\n  /**\r\n   * 获取管理员列表数据\r\n   */\r\n  const getAdminUsers = async () => {\r\n    let res = {}\r\n    try {\r\n      loading.value = true\r\n      res = await AdminModel.getAdminUsers({\r\n        groupId: groupId.value,\r\n        count: pageCount.value,\r\n        page: currentPage.value - 1,\r\n      })\r\n      loading.value = false\r\n      tableData.value = shuffleList(res.items)\r\n      totalNum.value = res.total\r\n    } catch (e) {\r\n      loading.value = false\r\n      console.error(e)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取所有分组数据\r\n   */\r\n  const getAllGroups = async () => {\r\n    try {\r\n      loading.value = true\r\n      allGroups.value = await AdminModel.getAllGroups()\r\n      loading.value = false\r\n    } catch (e) {\r\n      loading.value = false\r\n      console.error(e)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 多分组用 '，' 分割展示\r\n   */\r\n  const shuffleList = users => {\r\n    const list = []\r\n    users.forEach(element => {\r\n      element.groupNames = element.groups.map(item => item.name).join('，')\r\n      list.push(element)\r\n    })\r\n    return list\r\n  }\r\n\r\n  onMounted(async () => {\r\n    await getAdminUsers()\r\n    getAllGroups()\r\n  })\r\n\r\n  return {\r\n    groupId,\r\n    loading,\r\n    totalNum,\r\n    allGroups,\r\n    pageCount,\r\n    tableData,\r\n    currentPage,\r\n    getAdminUsers,\r\n  }\r\n}\r\n\r\nexport const useFormData = (ctx, dialogFormVisible, getAdminUsers, currentPage, loading, info, password) => {\r\n  const id = ref(null)\r\n  const activeTab = ref('修改信息')\r\n\r\n  /**\r\n   * 监听子组件更新管理员信息是否成功\r\n   * 如果更新了管理员信息，重新请求管理员列表\r\n   */\r\n  const handleInfoResult = flag => {\r\n    dialogFormVisible.value = false\r\n    if (flag === true) {\r\n      getAdminUsers()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据分组查询管理员\r\n   */\r\n  const handleChange = async () => {\r\n    currentPage.value = 1\r\n    loading.value = true\r\n    await getAdminUsers()\r\n    loading.value = false\r\n  }\r\n\r\n  /**\r\n   * 监听是否完成密码更新\r\n   * @param {boolean} result 是否完成密码更新\r\n   */\r\n  const handlePasswordResult = result => {\r\n    if (result === true) {\r\n      dialogFormVisible.value = false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 翻页\r\n   */\r\n  const handleCurrentChange = async val => {\r\n    currentPage.value = val\r\n    await getAdminUsers()\r\n  }\r\n\r\n  /**\r\n   * 提交表单信息，更新管理员信息\r\n   */\r\n  const confirmEdit = async () => {\r\n    if (activeTab.value === '修改信息') {\r\n      await info.value.submitForm()\r\n    } else {\r\n      await password.value.submitForm()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 关闭编辑弹窗\r\n   */\r\n  const handleClose = done => {\r\n    dialogFormVisible.value = false\r\n    password.value.resetForm()\r\n    activeTab.value = '修改信息'\r\n    done()\r\n  }\r\n\r\n  const handleClick = tab => {\r\n    activeTab.value = tab.props.name\r\n  }\r\n\r\n  /**\r\n   * 重置表单\r\n   */\r\n  const resetForm = () => {\r\n    if (activeTab.value === '修改信息') {\r\n      info.value.resetForm()\r\n    } else {\r\n      password.value.resetForm()\r\n    }\r\n  }\r\n\r\n  return {\r\n    id,\r\n    activeTab,\r\n    resetForm,\r\n    confirmEdit,\r\n    handleClose,\r\n    handleClick,\r\n    handleChange,\r\n    handleInfoResult,\r\n    handleCurrentChange,\r\n    handlePasswordResult,\r\n  }\r\n}\r\n","<template>\r\n  <div class=\"container\">\r\n    <div class=\"header\">\r\n      <div class=\"title\">用户列表</div>\r\n      <!-- 分组选择下拉框 -->\r\n      <el-select filterable v-model=\"groupId\" placeholder=\"请选择分组\" @change=\"handleChange\" clearable>\r\n        <el-option v-for=\"(group, index) in allGroups\" :key=\"index\" :label=\"group.name\" :value=\"group.id\"> </el-option>\r\n      </el-select>\r\n    </div>\r\n    <!-- 表格 -->\r\n    <el-table :data=\"tableData\" v-loading=\"loading\" @row-dblclick=\"rowDoubleClick\">\r\n      <el-table-column prop=\"username\" label=\"名称\"></el-table-column>\r\n      <el-table-column prop=\"groupNames\" label=\"所属分组\"></el-table-column>\r\n      <el-table-column label=\"操作\" fixed=\"right\" width=\"275\">\r\n        <template #default=\"scope\">\r\n          <el-button plain size=\"mini\" type=\"primary\" @click=\"handleEdit(scope.row)\">编辑</el-button>\r\n          <el-button plain size=\"mini\" type=\"danger\" @click=\"handleDelete(scope.row.id)\">删除</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <!-- 分页 -->\r\n    <div class=\"pagination\">\r\n      <el-pagination\r\n        :total=\"totalNum\"\r\n        :background=\"true\"\r\n        :page-size=\"pageCount\"\r\n        v-if=\"refreshPagination\"\r\n        :current-page=\"currentPage\"\r\n        layout=\"prev, pager, next, jumper\"\r\n        @current-change=\"handleCurrentChange\"\r\n      >\r\n      </el-pagination>\r\n    </div>\r\n    <!-- 弹窗 -->\r\n    <el-dialog title=\"用户信息\" :append-to-body=\"true\" :before-close=\"handleClose\" v-model=\"dialogFormVisible\">\r\n      <div style=\"margin-top: -25px\">\r\n        <el-tabs v-model=\"activeTab\" @tab-click=\"handleClick\">\r\n          <el-tab-pane label=\"修改信息\" name=\"修改信息\">\r\n            <user-info\r\n              :id=\"id\"\r\n              ref=\"info\"\r\n              class=\"info\"\r\n              pageType=\"edit\"\r\n              :info=\"userInfo\"\r\n              :submit=\"false\"\r\n              :allGroups=\"allGroups\"\r\n              labelPosition=\"right\"\r\n              v-if=\"dialogFormVisible\"\r\n              @handleInfoResult=\"handleInfoResult\"\r\n            />\r\n          </el-tab-pane>\r\n          <el-tab-pane label=\"修改密码\" name=\"修改密码\">\r\n            <user-password @handlePasswordResult=\"handlePasswordResult\" ref=\"password\" :id=\"id\" class=\"password\" />\r\n          </el-tab-pane>\r\n        </el-tabs>\r\n      </div>\r\n      <!-- 按键操作 -->\r\n      <template #footer>\r\n        <div class=\"dialog-footer\">\r\n          <el-button type=\"primary\" @click=\"confirmEdit\">确 定</el-button>\r\n          <el-button @click=\"resetForm\">重 置</el-button>\r\n        </div>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, reactive } from 'vue'\r\nimport { ElMessageBox, ElMessage } from 'element-plus'\r\nimport AdminModel from 'lin/model/admin'\r\n\r\nimport UserInfo from './user-info'\r\nimport UserPassword from './user-password'\r\nimport { useUserList, useFormData } from './use-user'\r\n\r\nexport default {\r\n  components: { UserInfo, UserPassword },\r\n  setup(props, ctx) {\r\n    const info = ref(false)\r\n    const password = ref(false)\r\n    const dialogFormVisible = ref(false) // 弹窗遮罩层\r\n    const refreshPagination = ref(true) // 页数增加的时候，因为缓存的缘故，需要刷新Pagination组件\r\n\r\n    const { allGroups, loading, groupId, totalNum, tableData, pageCount, currentPage, getAdminUsers } = useUserList()\r\n    const {\r\n      id,\r\n      activeTab,\r\n      resetForm,\r\n      confirmEdit,\r\n      handleClose,\r\n      handleClick,\r\n      handleChange,\r\n      handleInfoResult,\r\n      handleCurrentChange,\r\n      handlePasswordResult,\r\n    } = useFormData(ctx, dialogFormVisible, getAdminUsers, currentPage, loading, info, password)\r\n\r\n    const userInfo = reactive({\r\n      email: '',\r\n      username: '',\r\n      password: '',\r\n      groups: [],\r\n      confirm_password: '',\r\n    })\r\n\r\n    /**\r\n     * 修改管理员信息\r\n     */\r\n    const handleEdit = row => {\r\n      id.value = row.id\r\n      userInfo.email = row.email\r\n      userInfo.groups = row.groups\r\n      userInfo.username = row.username\r\n      dialogFormVisible.value = true\r\n    }\r\n\r\n    /**\r\n     * 删除管理员数据\r\n     */\r\n    const handleDelete = id => {\r\n      let res\r\n      ElMessageBox.confirm('此操作将永久删除该用户, 是否继续?', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning',\r\n      }).then(async () => {\r\n        try {\r\n          loading.value = true\r\n          res = await AdminModel.deleteOneUser(id)\r\n        } catch (e) {\r\n          loading.value = false\r\n          console.error(e)\r\n        }\r\n        if (res.code < window.MAX_SUCCESS_CODE) {\r\n          loading.value = false\r\n          if (totalNum.value % pageCount.value === 1 && currentPage.value !== 1) {\r\n            // 判断删除的是不是每一页的最后一条数据\r\n            currentPage.value--\r\n          }\r\n          await getAdminUsers()\r\n          ElMessage.success(`${res.message}`)\r\n        } else {\r\n          loading.value = false\r\n          ElMessage.error(`${res.message}`)\r\n        }\r\n      })\r\n    }\r\n\r\n    const rowDoubleClick = row => {\r\n      handleEdit(row)\r\n    }\r\n\r\n    return {\r\n      id,\r\n      info,\r\n      groupId,\r\n      loading,\r\n      password,\r\n      userInfo,\r\n      totalNum,\r\n      allGroups,\r\n      tableData,\r\n      activeTab,\r\n      resetForm,\r\n      pageCount,\r\n      handleEdit,\r\n      confirmEdit,\r\n      handleClose,\r\n      currentPage,\r\n      handleClick,\r\n      handleChange,\r\n      handleDelete,\r\n      rowDoubleClick,\r\n      handleInfoResult,\r\n      refreshPagination,\r\n      dialogFormVisible,\r\n      handleCurrentChange,\r\n      handlePasswordResult,\r\n    }\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.container {\r\n  padding: 0 30px;\r\n\r\n  .header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n\r\n    .title {\r\n      height: 59px;\r\n      line-height: 59px;\r\n      color: $parent-title-color;\r\n      font-size: 16px;\r\n      font-weight: 500;\r\n    }\r\n  }\r\n\r\n  .pagination {\r\n    display: flex;\r\n    justify-content: flex-end;\r\n    margin: 20px;\r\n  }\r\n}\r\n\r\n.info {\r\n  margin-left: -55px;\r\n  margin-bottom: -30px;\r\n}\r\n\r\n.password {\r\n  margin-top: 20px;\r\n  margin-left: -55px;\r\n  margin-bottom: -20px;\r\n}\r\n</style>\r\n","import { render } from \"./user-list.vue?vue&type=template&id=7a96a2fc&scoped=true\"\nimport script from \"./user-list.vue?vue&type=script&lang=js\"\nexport * from \"./user-list.vue?vue&type=script&lang=js\"\n\nimport \"./user-list.vue?vue&type=style&index=0&id=7a96a2fc&lang=scss&scoped=true\"\n\nimport exportComponent from \"E:\\\\postgraduatecode\\\\lin-cms-vue\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-7a96a2fc\"]])\n\nexport default __exports__","<template>\r\n  <div class=\"container\">\r\n    <el-form\r\n      ref=\"form\"\r\n      :model=\"info\"\r\n      status-icon\r\n      :rules=\"rules\"\r\n      v-loading=\"loading\"\r\n      label-width=\"100px\"\r\n      label-position=\"right\"\r\n    >\r\n      <el-form-item label=\"密码\" prop=\"newPassword\">\r\n        <el-input clearable type=\"password\" v-model=\"info.newPassword\" autocomplete=\"off\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"确认密码\" prop=\"confirmPassword\" label-position=\"top\">\r\n        <el-input clearable type=\"password\" v-model=\"info.confirmPassword\" autocomplete=\"off\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item v-show=\"false\">\r\n        <el-button type=\"primary\" @click=\"submitForm\">保存</el-button>\r\n        <el-button @click=\"resetForm\">取消</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ElMessage } from 'element-plus'\r\nimport { reactive, ref } from 'vue'\r\nimport AdminModel from '@/lin/model/admin'\r\n\r\nexport default {\r\n  props: ['id'],\r\n  setup(props, ctx) {\r\n    const form = ref(null)\r\n    const loading = ref(false)\r\n    const info = reactive({\r\n      newPassword: '',\r\n      confirmPassword: '',\r\n    })\r\n\r\n    /**\r\n     * 表单规则\r\n     */\r\n    const rules = getRules(ctx, info, form)\r\n\r\n    /**\r\n     * 提交表单数据\r\n     */\r\n    const submitForm = () => {\r\n      if (!info.newPassword && !info.confirmPassword) {\r\n        ctx.emit('handlePasswordResult', true)\r\n        return\r\n      }\r\n\r\n      form.value.validate(async valid => {\r\n        if (valid) {\r\n          let res = {}\r\n          try {\r\n            loading.value = true\r\n            res = await AdminModel.changePassword(info.newPassword, info.confirmPassword, props.id)\r\n          } catch (e) {\r\n            loading.value = false\r\n          }\r\n          if (res.code < window.MAX_SUCCESS_CODE) {\r\n            loading.value = false\r\n            ElMessage.success(`${res.message}`)\r\n            resetForm()\r\n            ctx.emit('handlePasswordResult', true)\r\n          } else {\r\n            loading.value = false\r\n            ElMessage.error(`${res.message}`)\r\n          }\r\n        } else {\r\n          ElMessage.error('请填写正确的密码信息')\r\n        }\r\n      })\r\n    }\r\n\r\n    // 重置表单\r\n    const resetForm = () => {\r\n      form.value.resetFields()\r\n    }\r\n\r\n    return {\r\n      info,\r\n      form,\r\n      rules,\r\n      loading,\r\n      resetForm,\r\n      submitForm,\r\n    }\r\n  },\r\n}\r\n\r\n/**\r\n * 表单规则\r\n */\r\nfunction getRules(ctx, info, form) {\r\n  const validatePassword = (rule, value, callback) => {\r\n    if (!value) {\r\n      callback(new Error('请输入密码'))\r\n    } else if (value.length < 6) {\r\n      callback(new Error('密码长度不能少于6位数'))\r\n    } else {\r\n      if (info.confirmPassword) {\r\n        form.value.validateField('confirmPassword')\r\n      }\r\n      callback()\r\n    }\r\n  }\r\n  const validatePassword2 = (rule, value, callback) => {\r\n    if (!value) {\r\n      callback(new Error('请再次输入密码'))\r\n    } else if (value !== info.newPassword) {\r\n      callback(new Error('两次输入密码不一致!'))\r\n    } else {\r\n      callback()\r\n    }\r\n  }\r\n\r\n  // 验证规则\r\n  return {\r\n    newPassword: [{ validator: validatePassword, trigger: 'blur', required: true }],\r\n    confirmPassword: [{ validator: validatePassword2, trigger: 'blur', required: true }],\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.el-form-item :v-deep(.el-form-item__label) {\r\n  padding-right: 10px !important;\r\n}\r\n</style>\r\n","import { render } from \"./user-password.vue?vue&type=template&id=16140bac&scoped=true\"\nimport script from \"./user-password.vue?vue&type=script&lang=js\"\nexport * from \"./user-password.vue?vue&type=script&lang=js\"\n\nimport \"./user-password.vue?vue&type=style&index=0&id=16140bac&lang=scss&scoped=true\"\n\nimport exportComponent from \"E:\\\\postgraduatecode\\\\lin-cms-vue\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-16140bac\"]])\n\nexport default __exports__"],"names":["useUserList","allGroups","ref","pageCount","tableData","groupId","loading","totalNum","currentPage","getAdminUsers","res","value","AdminModel","count","page","shuffleList","items","total","console","error","getAllGroups","users","list","forEach","element","groupNames","groups","map","item","name","join","push","onMounted","useFormData","ctx","dialogFormVisible","info","password","id","activeTab","handleInfoResult","flag","handleChange","handlePasswordResult","result","handleCurrentChange","val","confirmEdit","submitForm","handleClose","done","resetForm","handleClick","tab","props","class","style","filterable","placeholder","clearable","group","index","key","label","data","rowDoubleClick","prop","fixed","width","default","plain","size","type","handleEdit","scope","row","handleDelete","refreshPagination","background","layout","title","footer","pageType","userInfo","submit","labelPosition","components","UserInfo","UserPassword","setup","email","username","confirm_password","confirmButtonText","cancelButtonText","then","code","window","MAX_SUCCESS_CODE","message","__exports__","render","model","rules","newPassword","autocomplete","confirmPassword","form","getRules","validate","valid","emit","resetFields","validatePassword","rule","callback","length","Error","validateField","validatePassword2","validator","trigger","required"],"sourceRoot":""}